<html xmlns="http://www.w3.org/1999/xhtml">

<html>

<head>
  <meta charset="UTF-8">
  <!-- import CSS -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style type="text/css">
    .imgArea input {
      position: absolute;
      left: 0;
      width: 100%;
      height: 50px;
      opacity: 0;
      cursor: pointer;
      z-index: 5;
    }
  </style>
</head>

<body>
  <div id="app" style="width: 80%;margin: 0 auto;">
    <h1 style="text-align: center">活动主题列表</h1>
    <el-row :gutter="20" type="flex" align="middle" style="padding: 10px 0;background-color: #f9fafc;margin:10px 0;">
      <el-button type="primary" @click="onAddTopic()">添加主题</el-button>
    </el-row>
    </el-row>
    <template v-for="(item, index) in topicList">
      <el-row :gutter="20" type="flex" align="middle" style="padding: 10px 0;background-color: #f9fafc;margin:10px 0;">
        <el-col :span="6">
          <div class="grid-content">
            <img :src="item.logo_url" style="margin: 6px;width: 200px;" v-if="item.logo_url != ''">
          </div>
        </el-col>
        <el-col :span="6" :offset="1">
          <div class="grid-content">{{item.name}}</div>
          <div class="grid-content">{{item.introduction}}</div>
        </el-col>
        <el-col :span="7" :offset="1">
          <div class="grid-content"></div>
          <el-button type="primary" @click="onDetail(item)">详细</el-button>   
          <el-button type="primary" @click="onEdit(item)">编辑</el-button>       
          <el-button type="primary" @click="onRemove(item)">删除</el-button>
        </el-col>
      </el-row>
    </template>
  </div>
</body>
<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- import JavaScript -->
<!--<script src="https://unpkg.com/element-ui/lib/index.js"></script>-->
<script src="https://unpkg.com/element-ui@2.3.4/lib/index.js"></script>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-quill-editor@3.0.4/dist/vue-quill-editor.js"></script>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="cos-js-sdk-v5.min.js"></script>


<script>  
  Vue.use(VueQuillEditor);
  var app = new Vue({
    el: '#app',
    data: {
      topicList: [],
      currentActivityId:-1      
    },
    mounted: function () {
      // `this` 指向 vm 实例
      console.log('created');
      var that = this;
      var userId = sessionStorage.userId;

      var currentActivity = JSON.parse(sessionStorage.currentActivity);      
      this.currentActivityId = currentActivity.id;

      axios({
        url: '/weapp/WebTopic',
        //url: '/weapp/index.php/WebTopic',
        method: 'post',
        data: {
          userId: userId,
          activityId : this.currentActivityId
        },
        transformRequest: [function (data) {
          // Do whatever you want to transform the data
          let ret = ''
          for (let it in data) {
            ret += encodeURIComponent(it) + '=' + encodeURIComponent(data[it]) + '&'
          }
          return ret
        }],
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        }
      })
        .then(function (response) {

          //var res = JSON.parse(response);
          console.log("response" + response.data.code);
          if (response.data.code === 0) {
            console.log(response.data);
            var topicList = response.data.data;
            //that.topicList = response.data.data;
            //console.log(that.topicList);
            //window.location = "activity.html";
           for (var item in topicList) {       
              topicList[item].content = JSON.parse(topicList[item].content);  
              if(topicList[item].content_num == 0)
              {                
                for (var itemContent in topicList[item].content) {
                  topicList[item].content[itemContent].key = itemContent;
                }
              }
              /*if(topicList[item].content_num == 0)
              {
                topicList[item].content_num =topicList[item].content.length;
              }*/

              topicList[item].content = JSON.stringify(topicList[item].content); 
                          
            }

             that.topicList = topicList;
             console.log(that.topicList);
          }

        })
        .catch(function (error) {
          console.log(error);
        });
    },
    methods: {      
      onDetail(topic) {
        sessionStorage.currentTopic = JSON.stringify(topic);
        window.location = "topic.html";        
      },
      onEdit(topic) {
        sessionStorage.currentTopic = JSON.stringify(topic);
        window.location = "topic_edit.html";        
      },
      onRemove(topic) {
        sessionStorage.currentTopic = {};                
      },
      onAddTopic() {
        sessionStorage.currentActivityId = this.currentActivityId;
        window.location = "topic_add.html";        
      }
    }
  });

//列表

</script>

</html>